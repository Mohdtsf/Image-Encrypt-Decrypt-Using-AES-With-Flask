{% extends "base.html" %}
{% block title %}Decrypt â€” AES Image Crypto{% endblock %}

{% block content %}
<div class="page-card glass-card fade-in-up">
  <div class="page-card-header">
    <div class="page-icon decrypt-icon">
      <i class="fas fa-unlock"></i>
    </div>
    <h1 class="page-title">Decrypt Image</h1>
    <p class="page-subtitle">Upload an encrypted image and enter the key to restore it</p>
  </div>

  {% if error %}
  <div class="alert-custom" role="alert">
    <i class="fas fa-exclamation-circle"></i>
    <span>{{ error }}</span>
    <button type="button" class="btn-close btn-close-white btn-sm" onclick="this.parentElement.remove()" aria-label="Close"></button>
  </div>
  {% endif %}

  <form method="post" enctype="multipart/form-data" id="decrypt-form">
    <div class="form-group">
      <label class="form-label-custom">
        <i class="fas fa-file-shield me-1"></i> Select Encrypted Image
      </label>
      <div class="file-upload-area" id="upload-area" onclick="document.getElementById('file').click()">
        <i class="fas fa-cloud-arrow-up"></i>
        <p>Click to browse or drag &amp; drop</p>
        <span class="file-types">Supports: PNG, JPG, JPEG, GIF</span>
        <input type="file" id="file" name="file" accept=".png,.jpg,.jpeg,.gif" />
        <div class="file-name-display" id="file-name">
          <i class="fas fa-file-image"></i>
          <span id="file-name-text"></span>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label-custom" for="text">
        <i class="fas fa-key me-1"></i> Decryption Key
      </label>
      <input type="password" class="form-input" id="text" name="text"
        placeholder="Enter the key used during encryption" autocomplete="off" />
    </div>

    <button type="submit" class="btn-gradient decrypt-btn" id="decrypt-submit">
      <i class="fas fa-unlock"></i> Decrypt Image
    </button>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
  const fileInput = document.getElementById('file');
  const uploadArea = document.getElementById('upload-area');
  const fileNameDisplay = document.getElementById('file-name');
  const fileNameText = document.getElementById('file-name-text');

  fileInput.addEventListener('change', function() {
    if (this.files.length > 0) {
      fileNameText.textContent = this.files[0].name;
      fileNameDisplay.classList.add('active');
      uploadArea.style.borderColor = 'var(--accent-tertiary)';
      uploadArea.style.background = 'rgba(6, 182, 212, 0.08)';
    }
  });

  uploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.style.borderColor = 'var(--accent-tertiary)';
    this.style.background = 'rgba(6, 182, 212, 0.12)';
  });

  uploadArea.addEventListener('dragleave', function(e) {
    e.preventDefault();
    if (!fileInput.files.length) {
      this.style.borderColor = '';
      this.style.background = '';
    }
  });

  uploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    if (e.dataTransfer.files.length > 0) {
      fileInput.files = e.dataTransfer.files;
      fileNameText.textContent = e.dataTransfer.files[0].name;
      fileNameDisplay.classList.add('active');
      this.style.borderColor = 'var(--accent-tertiary)';
      this.style.background = 'rgba(6, 182, 212, 0.08)';
    }
  });
</script>
{% endblock %}